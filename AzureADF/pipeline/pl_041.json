{
	"name": "pl_041",
	"properties": {
		"activities": [
			{
				"name": "V162S0P2",
				"description": "Copy_2_of_DB2_Connector_96",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "Db2Source",
						"query": {
							"value": "SELECT CAST(AL1.CTRY_CD AS CHAR(4)) AS CNTRY\nFROM BMSIW.GEO_RGN_CTRY_UV AL1\nJOIN BMSIW.COUNTRY_REF_UV AL2 \n        ON AL1.CTRY_CD=AL2.COUNTRY_CD\n        AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}\n        AND AL2.STATUS='O'\nWHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}'\nOR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} AND '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}')\nFETCH FIRST 250 ROWS ONLY\nWITH UR",
							"type": "Expression"
						}
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceDB2",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": "V162S0P2.csv",
							"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N"
						}
					}
				]
			},
			{
				"name": "V162S3P2",
				"description": "Copy_5_of_DB2_Connector_96",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V162S0P2",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "Db2Source",
						"query": {
							"value": "SELECT V.WORKNUMBER AS WBS_ID,T.SAP_CMPNY_CD1 FROM BMSIW.T510WRK_UV V JOIN\n(SELECT DISTINCT V.RCVCUSTCTRY AS SAP_CMPNY_CD1,V.CONTRACTNUMBER AS PROJ_WBS_ID\nFROM BMSIW.T510WRK_UV           V \nJOIN  BMSIW.COUNTRY_REF_UV AL2 \nON V.COUNTRY=AL2.COUNTRY_CD\nJOIN  BMSIW.COUNTRY_REF_UV AL3\nON V.RCVCUSTCTRY=AL3.COUNTRY_CD\nJOIN BMSIW.GEO_RGN_CTRY_UV AL4\nON AL4.CTRY_CD=AL2.COUNTRY_CD\nJOIN BMSIW.GEO_RGN_CTRY_UV AL5\nON AL5.CTRY_CD=AL3.COUNTRY_CD\n   WHERE V.COUNTRY <> V.RCVCUSTCTRY \n   AND V.COUNTRY='606'\n AND V.CONTRACTNUMBER <>''  \n) T ON V.CONTRACTNUMBER = T.PROJ_WBS_ID WHERE V.WORKNUMBER<>''\nUNION\nSELECT V.ACCOUNT_ID AS WBS_ID,T.SAP_CMPNY_CD1 FROM BMSIW.ACCOUNT_UV V JOIN\n(SELECT DISTINCT  V.RCVCUSTCTRY AS SAP_CMPNY_CD1,V.CONTRACTNUMBER AS PROJ_WBS_ID\nFROM BMSIW.T510WRK_UV           V \nJOIN  BMSIW.COUNTRY_REF_UV AL2 \nON V.COUNTRY=AL2.COUNTRY_CD\nJOIN  BMSIW.COUNTRY_REF_UV AL3\nON V.RCVCUSTCTRY=AL3.COUNTRY_CD\nJOIN BMSIW.GEO_RGN_CTRY_UV AL4\nON AL4.CTRY_CD=AL2.COUNTRY_CD\nJOIN BMSIW.GEO_RGN_CTRY_UV AL5\nON AL5.CTRY_CD=AL3.COUNTRY_CD\n   WHERE V.COUNTRY <> V.RCVCUSTCTRY \n   AND V.COUNTRY='606'\n AND V.CONTRACTNUMBER <>''  \n) T ON V.ACCTGRP_ID  = T.PROJ_WBS_ID WHERE V.ACCOUNT_ID <>'' \nWITH UR",
							"type": "Expression"
						}
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceDB2",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": "V162S3P2.csv",
							"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N"
						}
					}
				]
			},
			{
				"name": "V162S13P3",
				"description": "EMF_RATE",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V162S3P2",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "NetezzaSource",
						"query": {
							"value": "SELECT CNUM_ID, CAST(NULL AS CHAR) AS WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, EMP_LVL_CD AS BAND, WEEKENDINGDATE, CURRENCY_CD, \n       CAST(NULL AS DECIMAL(20, 2)) AS BILL_RATE,  CAST(NULL AS DECIMAL(20, 2)) AS COST_RATE, EMF_RATE, CAST(GDC_FLG AS CHAR(1)) AS GDC_FLG, CAST(NULL AS CHAR) AS CNTRY\n  FROM ( SELECT ROW_NUMBER() OVER(PARTITION BY G.CNUM_ID ORDER BY DATE(G.LST_ALTR_TMS) DESC) AS RN, \n                G.CNUM_ID                      AS CNUM_ID, \n                G.EMP_SER_NUM                               AS SERIALNUMBER,\n                G.CTRY_CD                                   AS EMPLOYEECOUNTRY,\n                CASE\n                   WHEN G.EMP_STAT_CD = 'CT' THEN 'SUB'\n                   ELSE 'IBM'\n                END                                         AS RESOURCE_TYPE,\n                DATE(G.LST_ALTR_TMS)                        AS WEEKENDINGDATE,\n                G.LOC_CURR_CD                               AS CURRENCY_CD,\n                G.EMP_LVL_CD                                AS EMP_LVL_CD,\n                G.CHRG_AMT                                  AS EMF_RATE,\n                CASE\n                   WHEN MF.EMP_STATUS <> 'CT' AND G.BMS_SOP_HUB_ID IN ('DUB-RMC', 'SING-RMC') THEN 'Y'\n                   ELSE 'N'\n                END AS GDC_FLG    \n           FROM BMSIW.EMF_DATAMART_V G LEFT JOIN\n                BMSIW.EMP_MASTER_FILE_V MF\n                 ON MF.EMP_SER_NUM = G.EMP_SER_NUM\n                AND MF.COUNTRY_CODE = G.CTRY_CD\n                AND MF.COMPANY_CODE = G.CMPNY_CD           \n          WHERE  G.CHRG_AMT<>0.00 AND G.CNUM_ID IS NOT NULL\n               \n      ) RES\n WHERE RN=1",
							"type": "Expression"
						},
						"partitionOption": "None"
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceNetezza",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": "V162S13P3.csv",
							"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N"
						}
					}
				]
			},
			{
				"name": "V162S8P3",
				"description": "COST_RATE_PACT",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V162S13P3",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "NetezzaSource",
						"query": {
							"value": "SELECT CAST (NULL AS CHAR) AS CNUM_ID, WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, CAST(NULL AS CHAR) AS BAND, WEEKENDINGDATE, CURRENCY_CD, BILL_RATE, COST_RATE, EMF_RATE, CAST(NULL AS CHAR) AS GDC_FLG,CNTRY\nFROM (\nSELECT WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, '6' AS BAND, WEEKENDINGDATE, CURRENCY_CD, \n       CAST(NULL AS DECIMAL(20, 2)) AS BILL_RATE, CAST(TOT_CHRG_AMT/HRS_CST AS DECIMAL(20, 2)) AS COST_RATE, CAST(NULL AS DECIMAL(20, 2)) AS EMF_RATE,CNTRY,\n       ROW_NUMBER() OVER (PARTITION BY WBS_ID, SERIALNUMBER, EMPLOYEECOUNTRY ORDER BY WEEKENDINGDATE DESC) AS RN \nFROM (\n SELECT         CHRG_CUR_Y.ACCOUNT_ID                                AS WBS_ID,\n                CHRG_CUR_Y.ORIG_EMP_NUM                              AS SERIALNUMBER,\n                CHRG_CUR_Y.PRFRMNG_CTRY_CD                           AS EMPLOYEECOUNTRY,\n                CASE\n                    WHEN CHRG_CUR_Y.SERVICE_RESTYP_CD = 'CONTRACT' THEN 'SUB'\n                    ELSE 'IBM'\n                END AS RESOURCE_TYPE,\n                CHRG_CUR_Y.WEEK_ENDING_DATE                          AS WEEKENDINGDATE,  \n                CHRG_CUR_Y.ORIG_CURRENCY_CD                          AS CURRENCY_CD,\n                CAST (CHRG_CUR_Y.ORIGINAL_USAGE_QTY AS DOUBLE)       AS HRS_CST,\n                CHRG_CUR_Y.PROJECT_LC_AMT                              AS TOT_CHRG_AMT,\nWBS_ELM_MSR.OWNING_COUNTRY_CD AS CNTRY\n                FROM\n                    BMSIW.ACCOUNT_V AS WBS_ELM_MSR,\n                    BMSIW.LABOR_ALL_WWV           AS LBR,\n                    BDWDM.PROJECT_COST_CURR_WWV    AS CHRG_CUR_Y\n                WHERE LBR.ACCOUNT_ID = WBS_ELM_MSR.ACCOUNT_ID\n                AND (LBR.EMP_SER_NUM = CHRG_CUR_Y.ORIG_EMP_NUM\n                    AND LBR.EMP_COMPANY_CODE = CHRG_CUR_Y.PRFRMNG_CMPNY_CD\n                    AND LBR.COUNTRY_CODE = CHRG_CUR_Y.PRFRMNG_CTRY_CD\n                    AND LBR.WEEK_ENDING_DATE = CHRG_CUR_Y.WEEK_ENDING_DATE )\n                AND CHRG_CUR_Y.SERVICE_CLASS_CD = 'LABOR'\n                AND CHRG_CUR_Y.TOT_CHRG_AMT<>0.00\n                AND ( WBS_ELM_MSR.OWNING_COUNTRY_CD  IN (SELECT CAST(AL1.CTRY_CD AS CHAR(4))\nFROM BMSIW.GEO_RGN_CTRY_V AL1\nJOIN BMSIW.COUNTRY_REF_V AL2 \n        ON AL1.CTRY_CD=AL2.COUNTRY_CD\n        AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_MIGR}\n        AND AL2.STATUS='O'  AND AL1.CTRY_CD!='606'\nWHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}'\nOR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} AND '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}')\nLIMIT 250) OR WBS_ELM_MSR.OWNING_COUNTRY_CD='606')\nAND WBS_ELM_MSR.CONTROL_GROUP_CD  IN ('AP1','AUS1','BRZ1','CAN1','CAN2', 'EMEA','EMEA1', 'NA1', 'NA2')         \nAND WBS_ELM_MSR.ACCT_TYP_CD ='C'\nAND WBS_ELM_MSR.INSTALLATION_ID = 'PACT'\nAND WBS_ELM_MSR.CFT_WORK_NUM =''\nAND WBS_ELM_MSR.ACCOUNT_ID NOT IN\n(SELECT WKK.WORKNUMBER FROM BMSIW.T510WRK_V WKK /*FETCH FIRST 10000000 ROWS ONLY*/)     \n\nUNION ALL\n\n SELECT         CHRG_CUR_Y.ACCOUNT_ID                                AS WBS_ID,\n                CHRG_CUR_Y.ORIG_EMP_NUM                              AS SERIALNUMBER,\n                CHRG_CUR_Y.PRFRMNG_CTRY_CD                           AS EMPLOYEECOUNTRY,\n                CASE\n                    WHEN CHRG_CUR_Y.SERVICE_RESTYP_CD = 'CONTRACT' THEN 'SUB'\n                    ELSE 'IBM'\n                END AS RESOURCE_TYPE,\n                CHRG_CUR_Y.WEEK_ENDING_DATE                          AS WEEKENDINGDATE,  \n                CHRG_CUR_Y.ORIG_CURRENCY_CD                          AS CURRENCY_CD,\n                CAST (CHRG_CUR_Y.ORIGINAL_USAGE_QTY AS DOUBLE)       AS HRS_CST,\n                CHRG_CUR_Y.PROJECT_LC_AMT                              AS TOT_CHRG_AMT,\nWBS_ELM_MSR.OWNING_COUNTRY_CD AS CNTRY\n                FROM\n                    BMSIW.ACCOUNT_V AS WBS_ELM_MSR,\n                    BMSIW.LABOR_ALL_WWV           AS LBR,\n                    BDWDM.PROJECT_COST_PRIOR_WWV    AS CHRG_CUR_Y\n                WHERE LBR.ACCOUNT_ID = WBS_ELM_MSR.ACCOUNT_ID\n                AND (LBR.EMP_SER_NUM = CHRG_CUR_Y.ORIG_EMP_NUM\n                    AND LBR.EMP_COMPANY_CODE = CHRG_CUR_Y.PRFRMNG_CMPNY_CD\n                    AND LBR.COUNTRY_CODE = CHRG_CUR_Y.PRFRMNG_CTRY_CD\n                    AND LBR.WEEK_ENDING_DATE = CHRG_CUR_Y.WEEK_ENDING_DATE )\n                AND CHRG_CUR_Y.SERVICE_CLASS_CD = 'LABOR'\n                AND CHRG_CUR_Y.TOT_CHRG_AMT<>0.00\n                AND ( WBS_ELM_MSR.OWNING_COUNTRY_CD  IN (SELECT CAST(AL1.CTRY_CD AS CHAR(4))\nFROM BMSIW.GEO_RGN_CTRY_V AL1\nJOIN BMSIW.COUNTRY_REF_V AL2 \n        ON AL1.CTRY_CD=AL2.COUNTRY_CD\n        AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_MIGR}\n        AND AL2.STATUS='O'  AND AL1.CTRY_CD!='606'\nWHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}'\nOR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} AND '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}')\nLIMIT 250) OR WBS_ELM_MSR.OWNING_COUNTRY_CD='606')\nAND WBS_ELM_MSR.CONTROL_GROUP_CD  IN ('AP1','AUS1','BRZ1','CAN1','CAN2', 'EMEA','EMEA1', 'NA1', 'NA2')         \nAND WBS_ELM_MSR.ACCT_TYP_CD ='C'\nAND WBS_ELM_MSR.INSTALLATION_ID = 'PACT'\nAND WBS_ELM_MSR.CFT_WORK_NUM =''\nAND WBS_ELM_MSR.ACCOUNT_ID NOT IN\n(SELECT WKK.WORKNUMBER FROM BMSIW.T510WRK_V WKK /*FETCH FIRST 10000000 ROWS ONLY*/)\n )RES\n) RES_ALL\nWHERE RN=1",
							"type": "Expression"
						},
						"partitionOption": "None"
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceNetezza",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": "V162S8P3.csv",
							"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N"
						}
					}
				]
			},
			{
				"name": "V162S13P1",
				"description": "COST_RATE_BH",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V162S8P3",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "NetezzaSource",
						"query": {
							"value": "SELECT CAST (NULL AS CHAR) AS CNUM_ID, WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, CAST(NULL AS CHAR) AS BAND, WEEKENDINGDATE, CURRENCY_CD, BILL_RATE, COST_RATE, EMF_RATE, CAST(NULL AS CHAR) AS GDC_FLG, CAST(NULL AS CHAR) AS CNTRY\nFROM (\nSELECT WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, '6' AS BAND, WEEKENDINGDATE, CURRENCY_CD, \n       CAST(NULL AS DECIMAL(20, 2)) AS BILL_RATE, CAST(TOT_CHRG_AMT/HRS_CST AS DECIMAL(20, 2)) AS COST_RATE, CAST(NULL AS DECIMAL(20, 2)) AS EMF_RATE,\n       ROW_NUMBER() OVER (PARTITION BY WBS_ID, SERIALNUMBER, EMPLOYEECOUNTRY ORDER BY WEEKENDINGDATE DESC) AS RN \nFROM (\nSELECT\n        CAST(W.WBS_ID AS CHAR(11)) AS WBS_ID,\n        G.ORIG_EMP_NUM AS SERIALNUMBER,\n        G.PRFRMNG_CTRY_CD AS EMPLOYEECOUNTRY,\n        CASE\n                WHEN G.SERVICE_RESTYP_CD = 'CONTRACT' THEN 'SUB'\n                ELSE 'IBM'\n        END AS RESOURCE_TYPE,\n        G.WEEK_ENDING_DATE AS WEEKENDINGDATE,\n        G.ORIG_CURRENCY_CD AS CURRENCY_CD,\n        --G.PRFRMNG_CMPNY_CD AS EMP_CMPNY_CD,\n        CAST(G.ORIGINAL_USAGE_QTY AS DECIMAL(6,2)) AS HRS_CST,\n        G.PROJECT_LC_AMT AS TOT_CHRG_AMT\nFROM BDWDM.PROJECT_COST_CURR_WWV G\n\nINNER JOIN BLUEPP.WBS_ELEMENT_MASTER_V W\nON G.ACCOUNT_ID = W.WBS_SHORT_ID\n\nINNER JOIN BMSIW.LABOR_ALL_WWV LBR\nON LBR.EMP_SER_NUM = G.ORIG_EMP_NUM\nAND LBR.EMP_COMPANY_CODE = G.PRFRMNG_CMPNY_CD\nAND LBR.COUNTRY_CODE = G.PRFRMNG_CTRY_CD\nAND LBR.WEEK_ENDING_DATE = G.WEEK_ENDING_DATE\n\nINNER JOIN BMSIW.COMPANY_REF_V SC \nON SC.SAP_COMPANY_CD = W.SAP_CMPNY_CD \n\nWHERE SC.COUNTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}\nAND G.SERVICE_CLASS_CD = 'LABOR'\nAND G.TOT_CHRG_AMT<>0.00 \n\n\nUNION ALL\n\nSELECT\n        CAST(W.WBS_ID AS CHAR(11)) AS WBS_ID,\n        G.ORIG_EMP_NUM AS SERIALNUMBER,\n        G.PRFRMNG_CTRY_CD AS EMPLOYEECOUNTRY,\n        CASE\n                WHEN G.SERVICE_RESTYP_CD = 'CONTRACT' THEN 'SUB'\n                ELSE 'IBM'\n        END AS RESOURCE_TYPE,\n        G.WEEK_ENDING_DATE AS WEEKENDINGDATE,\n        G.ORIG_CURRENCY_CD AS CURRENCY_CD,\n        --G.PRFRMNG_CMPNY_CD AS EMP_CMPNY_CD,\n        CAST(G.ORIGINAL_USAGE_QTY AS DECIMAL(6,2)) AS HRS_CST,\n        G.PROJECT_LC_AMT AS TOT_CHRG_AMT\nFROM BDWDM.PROJECT_COST_PRIOR_WWV G\n\nINNER JOIN BLUEPP.WBS_ELEMENT_MASTER_V W\nON G.ACCOUNT_ID = W.WBS_SHORT_ID\n\nINNER JOIN BMSIW.LABOR_ALL_WWV LBR\nON LBR.EMP_SER_NUM = G.ORIG_EMP_NUM\nAND LBR.EMP_COMPANY_CODE = G.PRFRMNG_CMPNY_CD\nAND LBR.COUNTRY_CODE = G.PRFRMNG_CTRY_CD\nAND LBR.WEEK_ENDING_DATE = G.WEEK_ENDING_DATE\n\nINNER JOIN BMSIW.COMPANY_REF_V SC \nON SC.SAP_COMPANY_CD = W.SAP_CMPNY_CD \n\nWHERE SC.COUNTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}\nAND G.SERVICE_CLASS_CD = 'LABOR'\nAND G.TOT_CHRG_AMT<>0.00 \n\n )RES\n) RES_ALL\nWHERE RN=1",
							"type": "Expression"
						},
						"partitionOption": "None"
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceNetezza",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": "V162S13P1.csv",
							"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N"
						}
					}
				]
			},
			{
				"name": "V162S8P1",
				"description": "COST_RATE_BMS",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V162S13P1",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "NetezzaSource",
						"query": {
							"value": "SELECT CAST (NULL AS CHAR) AS CNUM_ID, WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, CAST(NULL AS CHAR) AS BAND, WEEKENDINGDATE, CURRENCY_CD, BILL_RATE, COST_RATE, EMF_RATE, CAST(NULL AS CHAR) AS GDC_FLG,CNTRY\nFROM (\nSELECT WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, '6' AS BAND, WEEKENDINGDATE, CURRENCY_CD, \n       CAST(NULL AS DECIMAL(20, 2)) AS BILL_RATE, CAST(TOT_CHRG_AMT/HRS_CST AS DECIMAL(20, 2)) AS COST_RATE, CAST(NULL AS DECIMAL(20, 2)) AS EMF_RATE,CNTRY,\n       ROW_NUMBER() OVER (PARTITION BY WBS_ID, SERIALNUMBER, EMPLOYEECOUNTRY ORDER BY WEEKENDINGDATE DESC) AS RN \nFROM (\n SELECT         CHRG_CUR_Y.ACCOUNT_ID                                AS WBS_ID,\n                CHRG_CUR_Y.ORIG_EMP_NUM                              AS SERIALNUMBER,\n                CHRG_CUR_Y.PRFRMNG_CTRY_CD                           AS EMPLOYEECOUNTRY,\n                CASE\n                    WHEN CHRG_CUR_Y.SERVICE_RESTYP_CD = 'CONTRACT' THEN 'SUB'\n                    ELSE 'IBM'\n                END AS RESOURCE_TYPE,\n                CHRG_CUR_Y.WEEK_ENDING_DATE                          AS WEEKENDINGDATE,  \n                CHRG_CUR_Y.ORIG_CURRENCY_CD                          AS CURRENCY_CD,\n                CAST (CHRG_CUR_Y.ORIGINAL_USAGE_QTY AS DOUBLE)       AS HRS_CST,\n                CHRG_CUR_Y.PROJECT_LC_AMT                              AS TOT_CHRG_AMT,\n                WBS_ELM_MSR.COUNTRY AS CNTRY\n                FROM\n                    BMSIW.T510WRK_V AS WBS_ELM_MSR,\n                    BMSIW.LABOR_ALL_WWV           AS LBR,\n                    BDWDM.PROJECT_COST_CURR_WWV    AS CHRG_CUR_Y\n                WHERE LBR.ACCOUNT_ID = WBS_ELM_MSR.WORKNUMBER\n                AND (LBR.EMP_SER_NUM = CHRG_CUR_Y.ORIG_EMP_NUM\n                    AND LBR.EMP_COMPANY_CODE = CHRG_CUR_Y.PRFRMNG_CMPNY_CD\n                    AND LBR.COUNTRY_CODE = CHRG_CUR_Y.PRFRMNG_CTRY_CD\n                    AND LBR.WEEK_ENDING_DATE = CHRG_CUR_Y.WEEK_ENDING_DATE )\n                AND CHRG_CUR_Y.SERVICE_CLASS_CD = 'LABOR'\n                AND CHRG_CUR_Y.TOT_CHRG_AMT<>0.00\n                AND (WBS_ELM_MSR.COUNTRY  IN (SELECT CAST(AL1.CTRY_CD AS CHAR(4))\nFROM BMSIW.GEO_RGN_CTRY_V AL1\nJOIN BMSIW.COUNTRY_REF_V AL2 \n          ON AL1.CTRY_CD=AL2.COUNTRY_CD\n        AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_MIGR}\n        AND AL2.STATUS='O'  AND AL1.CTRY_CD!='606'\nWHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}'\nOR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} AND '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}')\nLIMIT 250) OR WBS_ELM_MSR.COUNTRY='606')\n\nUNION ALL\n\n SELECT         CHRG_CUR_Y.ACCOUNT_ID                                AS WBS_ID,\n                CHRG_CUR_Y.ORIG_EMP_NUM                              AS SERIALNUMBER,\n                CHRG_CUR_Y.PRFRMNG_CTRY_CD                           AS EMPLOYEECOUNTRY,\n                CASE\n                    WHEN CHRG_CUR_Y.SERVICE_RESTYP_CD = 'CONTRACT' THEN 'SUB'\n                    ELSE 'IBM'\n                END AS RESOURCE_TYPE,\n                CHRG_CUR_Y.WEEK_ENDING_DATE                          AS WEEKENDINGDATE,  \n                CHRG_CUR_Y.ORIG_CURRENCY_CD                          AS CURRENCY_CD,\n                CAST (CHRG_CUR_Y.ORIGINAL_USAGE_QTY AS DOUBLE)       AS HRS_CST,\n                CHRG_CUR_Y.PROJECT_LC_AMT                              AS TOT_CHRG_AMT,\n                WBS_ELM_MSR.COUNTRY AS CNTRY\n                FROM\n                    BMSIW.T510WRK_V AS WBS_ELM_MSR,\n                    BMSIW.LABOR_ALL_WWV           AS LBR,\n                    BDWDM.PROJECT_COST_PRIOR_WWV    AS CHRG_CUR_Y\n                WHERE LBR.ACCOUNT_ID = WBS_ELM_MSR.WORKNUMBER\n                AND (LBR.EMP_SER_NUM = CHRG_CUR_Y.ORIG_EMP_NUM\n                    AND LBR.EMP_COMPANY_CODE = CHRG_CUR_Y.PRFRMNG_CMPNY_CD\n                    AND LBR.COUNTRY_CODE = CHRG_CUR_Y.PRFRMNG_CTRY_CD\n                    AND LBR.WEEK_ENDING_DATE = CHRG_CUR_Y.WEEK_ENDING_DATE )\n                AND CHRG_CUR_Y.SERVICE_CLASS_CD = 'LABOR'\n                AND CHRG_CUR_Y.TOT_CHRG_AMT<>0.00\n                AND (WBS_ELM_MSR.COUNTRY  IN (SELECT CAST(AL1.CTRY_CD AS CHAR(4))\nFROM BMSIW.GEO_RGN_CTRY_V AL1\nJOIN BMSIW.COUNTRY_REF_V AL2 \n          ON AL1.CTRY_CD=AL2.COUNTRY_CD\n        AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_MIGR}\n        AND AL2.STATUS='O'  AND AL1.CTRY_CD!='606'\nWHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}'\nOR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} AND '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}')\nLIMIT 250) OR WBS_ELM_MSR.COUNTRY='606')\n )RES\n) RES_ALL\nWHERE RN=1",
							"type": "Expression"
						},
						"partitionOption": "None"
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceNetezza",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": "V162S8P1.csv",
							"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N"
						}
					}
				]
			},
			{
				"name": "V162S8P2",
				"description": "BILL_RATE",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V162S8P1",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "NetezzaSource",
						"query": {
							"value": "SELECT CAST (NULL AS CHAR) AS CNUM_ID, WBS_ID, EMPLOYEECOUNTRY, SERIALNUMBER, RESOURCE_TYPE, CAST(NULL AS CHAR) AS BAND, WEEKENDINGDATE, CURRENCY_CD, \n               CAST (BILL_RATE AS DECIMAL(20,2)) AS BILL_RATE, CAST(NULL AS DECIMAL(20, 2)) AS COST_RATE, CAST(NULL AS DECIMAL(20, 2)) AS EMF_RATE, CAST(NULL AS CHAR) AS GDC_FLG,CNTRY\n  FROM ( SELECT WRK.CURRENCYID AS CURRENCY_CD, CASE\n                                                  WHEN AL1.EMPLOYEETYPE = '2' THEN 'SUB'\n                                                  ELSE 'IBM'\n                                               END AS RESOURCE_TYPE,\n                ROW_NUMBER() OVER (PARTITION BY AL1.WORKNUMBER, AL1.SERIALNUMBER, AL1.EMPLOYEECOUNTRY ORDER BY AL1.WEEKENDINGDATE DESC) AS RN,\n                AL1.WORKNUMBER AS WBS_ID,\n                AL1.EMPLOYEECOUNTRY,\n                AL1.SERIALNUMBER,\n                AL1.WEEKENDINGDATE,\n                CAST(AL1.BILLAMOUNT AS DECIMAL(20,2))/(DAILYHOURSSUN+DAILYHOURSMON+DAILYHOURSTUE+DAILYHOURSWED+DAILYHOURSTHU+DAILYHOURSFRI+DAILYHOURSSAT) AS BILL_RATE,\n                WRK.COUNTRY AS CNTRY\n           FROM BMSIW.T510LBR_V AL1 JOIN \n                BMSIW.T510WRK_V WRK ON AL1.WORKNUMBER = WRK.WORKNUMBER\n          WHERE AL1.BILLINGRATE<>0.00  AND \n                (WRK.COUNTRY  IN (SELECT CAST(AL1.CTRY_CD AS CHAR(4))\nFROM BMSIW.GEO_RGN_CTRY_V AL1\nJOIN BMSIW.COUNTRY_REF_V AL2 \n        ON AL1.CTRY_CD=AL2.COUNTRY_CD\n        AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}\n        AND AL1.CTRY_CD NOT @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_MIGR}\n        AND AL2.STATUS='O' AND AL1.CTRY_CD!='606'\nWHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}'\nOR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} AND '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '||'@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}')\nLIMIT 250) OR WRK.COUNTRY='606') \nAND (DAILYHOURSSUN+DAILYHOURSMON+DAILYHOURSTUE+DAILYHOURSWED+DAILYHOURSTHU+DAILYHOURSFRI+DAILYHOURSSAT)<>0\n       ) RES\n WHERE RN=1",
							"type": "Expression"
						},
						"partitionOption": "None"
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceNetezza",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": "V162S8P2.csv",
							"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N"
						}
					}
				]
			},
			{
				"name": "Transformation",
				"type": "ExecuteDataFlow",
				"dependsOn": [
					{
						"activity": "V162S8P2",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"dataflow": {
						"referenceName": "df_041",
						"type": "DataFlowReference",
						"parameters": {
							"p_IPPF_RULES_SCHEME": {
								"value": "'@{pipeline().parameters.p_IPPF_RULES_SCHEME}'",
								"type": "Expression"
							}
						},
						"datasetParameters": {
							"V162S0P2": {
								"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N",
								"p_fileName": "V162S0P2.csv"
							},
							"V162S3P2": {
								"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N",
								"p_fileName": "V162S3P2.csv"
							},
							"V162S13P3": {
								"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N",
								"p_fileName": "V162S13P3.csv"
							},
							"V162S8P3": {
								"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N",
								"p_fileName": "V162S8P3.csv"
							},
							"V162S13P1": {
								"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N",
								"p_fileName": "V162S13P1.csv"
							},
							"V162S8P1": {
								"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N",
								"p_fileName": "V162S8P1.csv"
							},
							"V162S8P2": {
								"p_folder": "LIPPFD0041_WBS_RESOURCE_DATA_LOAD_INIT_INTGRT_N",
								"p_fileName": "V162S8P2.csv"
							},
							"V162S7": {
								"p_schema": {
									"value": "@{pipeline().parameters.p_IPPF_RULES_SCHEME}",
									"type": "Expression"
								},
								"p_table": "WBS_RESOURCE_DATA_LOAD"
							}
						}
					},
					"integrationRuntime": {
						"referenceName": "ir-azure-DataFlow",
						"type": "IntegrationRuntimeReference"
					},
					"traceLevel": "None"
				}
			}
		],
		"parameters": {
			"p_IPPF_RULES_COUNTRIES": {
				"type": "String"
			},
			"p_IPPF_RULES_COUNTRIES_BH": {
				"type": "String"
			},
			"p_IPPF_RULES_COUNTRIES_MIGR": {
				"type": "String"
			},
			"p_IPPF_RULES_GEO_NAME": {
				"type": "String"
			},
			"p_IPPF_RULES_INST": {
				"type": "String"
			},
			"p_IPPF_RULES_RGN_LVL1_CD": {
				"type": "String"
			},
			"p_IPPF_RULES_SCHEME": {
				"type": "String"
			}
		},
		"annotations": []
	}
}