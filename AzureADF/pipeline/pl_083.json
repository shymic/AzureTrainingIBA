{
	"name": "pl_083",
	"properties": {
		"activities": [
			{
				"name": "V160S1P2",
				"description": "Copy_5_of_DB2_Connector_96",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "Db2Source",
						"query": {
							"value": "select v.worknumber as wbs_id,t.SAP_CMPNY_CD1 from bmsiw.t510wrk_uv v join (SELECT distinct v.RCVCUSTCTRY as SAP_CMPNY_CD1,v.contractnumber as PROJ_WBS_ID FROM BMSIW.t510wrk_uV           V  JOIN  BMSIW.COUNTRY_REF_UV AL2  ON v.COUNTRY=AL2.COUNTRY_CD JOIN  BMSIW.COUNTRY_REF_UV AL3 ON v.RCVCUSTCTRY=AL3.COUNTRY_CD JOIN BMSIW.GEO_RGN_CTRY_UV AL4 ON AL4.CTRY_CD=AL2.COUNTRY_CD JOIN BMSIW.GEO_RGN_CTRY_UV AL5 ON AL5.CTRY_CD=AL3.COUNTRY_CD    where v.country <> v.RCVCUSTCTRY     and v.country='606'  and v.contractnumber <>''   ) t on v.contractnumber = t.PROJ_WBS_ID where v.worknumber<>'' union select v.account_id as wbs_id,t.SAP_CMPNY_CD1 from BMSIW.ACCOUNT_UV v join (SELECT distinct  v.RCVCUSTCTRY as SAP_CMPNY_CD1,v.contractnumber as PROJ_WBS_ID FROM BMSIW.t510wrk_uV           V  JOIN  BMSIW.COUNTRY_REF_UV AL2  ON v.COUNTRY=AL2.COUNTRY_CD JOIN  BMSIW.COUNTRY_REF_UV AL3 ON v.RCVCUSTCTRY=AL3.COUNTRY_CD JOIN BMSIW.GEO_RGN_CTRY_UV AL4 ON AL4.CTRY_CD=AL2.COUNTRY_CD JOIN BMSIW.GEO_RGN_CTRY_UV AL5 ON AL5.CTRY_CD=AL3.COUNTRY_CD    where v.country <> v.RCVCUSTCTRY     and v.country='606'  and v.contractnumber <>''   ) t on v.ACCTGRP_ID  = t.PROJ_WBS_ID where v.account_id <>''  WITH UR",
							"type": "Expression"
						}
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceDB2",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": {
								"value": "V160S1P2.csv",
								"type": "Expression"
							},
							"p_folder": {
								"value": "@{pipeline().parameters.p_folder}",
								"type": "Expression"
							}
						}
					}
				]
			},
			{
				"name": "V160S4P2",
				"description": "Copy_2_of_DB2_Connector_96",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V160S1P2",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "Db2Source",
						"query": {
							"value": "SELECT cast(AL1.CTRY_CD as char(4)) as SAP_CMPNY_CD FROM BMSIW.GEO_RGN_CTRY_UV AL1 JOIN BMSIW.COUNTRY_REF_UV AL2          ON AL1.CTRY_CD=AL2.COUNTRY_CD         AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}         AND AL2.STATUS='O'  WHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '  '@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}' OR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} and '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '  '@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}') fetch first 250 rows only WITH UR",
							"type": "Expression"
						}
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceDB2",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": {
								"value": "V160S4P2.csv",
								"type": "Expression"
							},
							"p_folder": {
								"value": "@{pipeline().parameters.p_folder}",
								"type": "Expression"
							}
						}
					}
				]
			},
			{
				"name": "V160S1P1",
				"description": "BMSIW_WORK_ITEMS_V",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "V160S4P2",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "Db2Source",
						"query": {
							"value": "select  WI.WORK_ITEM_ID as WRK_ITM, replace(WI.WORK_ITEM_TITLE,X'41',X'40') as WRK_ITM_DESC, WI.ACCOUNT_ID as WBS_ID, WRK.COUNTRY as SAP_CMPNY_CD from BMSIW.T510BUS_UV        BUS, BMSIW.T510CON_UV        CON, BMSIW.T510WRK_UV        WRK  join BMSIW.WORK_ITEMS_UV WI on wrk.WORKNUMBER=wi.ACCOUNT_ID  WHERE  BUS.COUNTRY        = WRK.COUNTRY               AND    BUS.COMPANYCODE    = WRK.COMPANYCODE           AND    BUS.BUSINESSTYPE   = WRK.BUSINESSTYPE        AND    WRK.COUNTRY        = CON.COUNTRY               AND    WRK.COMPANYCODE    = CON.COMPANYCODE           AND    WRK.CONTRACTNUMBER = CON.CONTRACTNUMBER           AND ( substr(char(CON.CONTRENDDATE),1,7) >= substr(char(current date  - 3 YEARS),1,7)   OR    CON.CONTRACTSTATUS IN ( 'A', 'P' ) )               AND  (  WRK.COUNTRY in (SELECT cast(AL1.CTRY_CD as char(4)) FROM BMSIW.GEO_RGN_CTRY_UV AL1 JOIN BMSIW.COUNTRY_REF_UV AL2          ON AL1.CTRY_CD=AL2.COUNTRY_CD         AND AL1.RGN_LVL1_CD @{pipeline().parameters.p_IPPF_RULES_RGN_LVL1_CD}         AND AL1.CTRY_CD not @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_BH}         AND AL1.CTRY_CD not @{pipeline().parameters.p_IPPF_RULES_COUNTRIES_MIGR}         AND AL2.STATUS='O'  and AL1.CTRY_CD!='606' WHERE '@{pipeline().parameters.p_IPPF_RULES_INST}'<>'CDT - '  '@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}' OR (AL1.CTRY_CD @{pipeline().parameters.p_IPPF_RULES_COUNTRIES} and '@{pipeline().parameters.p_IPPF_RULES_INST}'='CDT - '  '@{pipeline().parameters.p_IPPF_RULES_GEO_NAME}') fetch first 250 rows only) or (WRK.COUNTRY='606')) --AND    BU.BUSMEASUREDIV   @{pipeline().parameters.p_IPPF_RULES_DIVISIONS} --@{pipeline().parameters.p_IPPF_RULES_GEO} and WRK.WORKNUMBER<>''  WITH UR  /*select  WI.WORK_ITEM_ID as WRK_ITM, WI.WORK_ITEM_TITLE as WRK_ITM_DESC, WI.ACCOUNT_ID as WBS_ID  from BMSIW.WORK_ITEMS_UV WI where WI.ITEM_COUNTRY_CODE @{pipeline().parameters.p_IPPF_RULES_COUNTRIES}*/     ",
							"type": "Expression"
						}
					},
					"sink": {
						"type": "DelimitedTextSink",
						"storeSettings": {
							"type": "AzureBlobStorageWriteSettings"
						},
						"formatSettings": {
							"type": "DelimitedTextWriteSettings",
							"quoteAllText": true,
							"fileExtension": ".txt"
						}
					},
					"enableStaging": false,
					"dataIntegrationUnits": 2,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "ds_sourceDB2",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "ds_sourceCSV",
						"type": "DatasetReference",
						"parameters": {
							"p_fileName": {
								"value": "V160S1P1.csv",
								"type": "Expression"
							},
							"p_folder": {
								"value": "@{pipeline().parameters.p_folder}",
								"type": "Expression"
							}
						}
					}
				]
			}
		],
		"parameters": {
			"p_IPPF_RULES_DIVISIONS": {
				"type": "String"
			},
			"p_IPPF_RULES_GEO": {
				"type": "String"
			},
			"p_IPPF_RULES_RGN_LVL1_CD": {
				"type": "String"
			},
			"p_IPPF_RULES_COUNTRIES_BH": {
				"type": "String"
			},
			"p_IPPF_RULES_COUNTRIES_MIGR": {
				"type": "String"
			},
			"p_IPPF_RULES_GEO_NAME": {
				"type": "String"
			},
			"p_IPPF_RULES_INST": {
				"type": "String"
			},
			"p_folder": {
				"type": "String"
			},
			"p_IPPF_RULES_COUNTRIES": {
				"type": "String"
			}
		},
		"folder": {
			"name": "obachilo"
		},
		"annotations": []
	}
}